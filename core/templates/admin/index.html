{% extends "admin/base.html" %}
{% set title = "الرئيسية" %}
{% block content %}

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div>
      <h3 class="mb-0 fw-bold">لوحة التحكم</h3>
      <div class="small-muted">نظرة سريعة على آخر {{ lookback_days }} أيام.</div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-md-4">
      <div class="card kpi-card border-info">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <div class="kpi-title"><i class="bi bi-receipt me-2"></i>شاراتي (Paper)</div>
            <span class="badge text-bg-info">Live</span>
          </div>
          <div class="display-6 kpi-value mt-2">{{ paper_count }}</div>
          <div class="small-muted">آخر {{ lookback_days }} أيام</div>
          <a class="btn btn-outline-info mt-3" href="{{ url_for('admin.paper') }}">فتح</a>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4">
      <div class="card kpi-card border-success">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <div class="kpi-title"><i class="bi bi-lightning-charge me-2"></i>Signals للتعلّم</div>
            <span class="badge text-bg-success">AI</span>
          </div>
          <div class="display-6 kpi-value mt-2">{{ signals_count }}</div>
          <div class="small-muted">آخر {{ lookback_days }} أيام (من آخر 200)</div>
          <a class="btn btn-outline-success mt-3" href="{{ url_for('admin.signals') }}">فتح</a>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4" id="maintenance">
      <div class="card kpi-card border-warning">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <div class="kpi-title"><i class="bi bi-wrench-adjustable me-2"></i>صيانة</div>
            <span class="badge text-bg-warning">Tools</span>
          </div>
          <div class="small-muted mt-2 mb-2">تنظيف تلقائي موجود، وهذا زر تنظيف يدوي إذا احتجت.</div>
          <form method="post" action="{{ url_for('admin.cleanup') }}" class="d-flex gap-2">
            <input class="form-control" name="days" type="number" min="1" max="365" value="{{ lookback_days }}">
            <button class="btn btn-warning" type="submit"><i class="bi bi-trash3 me-1"></i>تنظيف</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-2">
    <div class="col-12 col-lg-5">
      <div class="card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <span><i class="bi bi-bar-chart-line me-2"></i>أكثر الأسهم ظهورًا (Signals)</span>
          <span class="small-muted">Top 10</span>
        </div>
        <div class="card-body">
          {% if top_symbols %}
            <ul class="list-group list-group-flush">
              {% for sym, c in top_symbols %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span class="mono">{{ sym }}</span>
                  <span class="badge bg-secondary">{{ c }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="small-muted">لا توجد بيانات كافية.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-7">
      <div class="card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <span><i class="bi bi-clock-history me-2"></i>آخر شارات (Paper)</span>
          <a class="btn btn-sm btn-outline-info" href="{{ url_for('admin.paper') }}"><i class="bi bi-arrow-left-short"></i>عرض الكل</a>
        </div>
        <div class="card-body table-responsive">
          <table class="table table-sm table-hover align-middle">
            <thead>
              <tr>
                <th>وقت</th>
                <th>السهم</th>
                <th>Mode</th>
                <th>Side</th>
                <th>Entry</th>
                <th>SL</th>
                <th>TP</th>
              </tr>
            </thead>
            <tbody>
              {% for r in recent_paper %}
                <tr>
                  <td class="small-muted">{{ r.signal_ts }}</td>
                  <td class="mono fw-bold">{{ r.symbol }}</td>
                  <td>{{ r.mode }}</td>
                  <td>{{ r.side }}</td>
                  <td class="mono">{{ r.entry }}</td>
                  <td class="mono">{{ r.sl }}</td>
                  <td class="mono">{{ r.tp }}</td>
                </tr>
              {% endfor %}
              {% if not recent_paper %}
                <tr><td colspan="7" class="small-muted">ما فيه شارات حالياً.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
